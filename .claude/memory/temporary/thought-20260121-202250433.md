---
type: breadcrumb
title: "Think: Session Summary Plugin Architecture Evaluation"
topic: Session Summary Plugin Architecture Evaluation
status: concluded
created: "2026-01-21T20:22:50.438Z"
updated: "2026-01-21T20:23:56.783Z"
tags:
  - think
  - concluded
scope: project
conclusion: "RECOMMENDED APPROACH: Hybrid strategy with practical trade-offs. PreCompact: Simple append-only log (.claude/summaries/{session_id}.log) with extracted content, no complex state tracking. Command: Full parse with segment detection. Rationale: 1) Avoid race conditions from meta file updates. 2) Duplicates are acceptable (idempotent extraction). 3) Bug workaround: Glob search for session_id.jsonl. 4) Keep it simple - premature optimisation avoided."
promotedTo: decision-session-summary-plugin-architecture-evaluation
---

# Session Summary Plugin Architecture Evaluation

_Thinking document created 2026-01-21T20:22:50.438Z_

## Thoughts

### 2026-01-21T20:22:58.847Z - Thought
Proposed Update Strategy: Meta file with lastLineExtracted checkpoint. Questions: 1) How to handle concurrent PreCompact events? 2) Is line-based extraction robust for JSONL? 3) What about the transcript_path bug workaround?

### 2026-01-21T20:23:24.640Z - Thought
Key Research Findings: 1) PreCompact hook bug #13668 - transcript_path is empty string. 2) Hook input includes session_id, cwd, trigger (auto/manual). 3) Transcript format is JSONL at ~/.claude/projects/{slug}/{session_id}.jsonl. 4) Session boundaries marked by file-history-snapshot with isSnapshotUpdate: false. 5) Compaction marker is system message with subtype: compact_boundary.

### 2026-01-21T20:23:33.845Z - Thought
Alternative Approaches: 1) FULL LOAD: Read entire transcript on demand (simple but memory-intensive). 2) STREAMING: Use line-by-line streaming with checkpoint (complex but scalable). 3) HYBRID: Full load for command, incremental for PreCompact hook. 4) SESSION-AWARE: Track session boundaries during extraction, create one segment per session.

### 2026-01-21T20:23:35.449Z - Counter-argument
Concern with meta file approach: Race conditions if multiple PreCompact events fire rapidly. JSONL appends are atomic but meta file updates are not. Could lose checkpoint state. Consider: 1) File locking, 2) Append-only log instead of meta file, 3) Accept that duplicates are tolerable.

### 2026-01-21T20:23:43.148Z - Alternative
Workaround for transcript_path bug: 1) Construct path manually: ~/.claude/projects/{slug}/{session_id}.jsonl. But what is 'slug'? 2) Parse session_id from hook input, scan ~/.claude/projects/*/ for matching .jsonl. 3) Use glob pattern: ~/.claude/projects/**/{session_id}.jsonl. 4) Add fallback in code: if transcript_path empty, derive from session_id.

### 2026-01-21T20:23:55.225Z - Thought
Edge Cases to Consider: 1) Empty sessions (no assistant messages). 2) Very large transcripts (100K+ lines). 3) Concurrent PreCompact events (multiple compactions in quick succession). 4) Session without compaction (command-only extraction). 5) Corrupted JSONL lines. 6) Missing file-history-snapshot markers. 7) Multiple segments created before command retrieval.

### 2026-01-21T20:23:56.782Z - Conclusion
RECOMMENDED APPROACH: Hybrid strategy with practical trade-offs. PreCompact: Simple append-only log (.claude/summaries/{session_id}.log) with extracted content, no complex state tracking. Command: Full parse with segment detection. Rationale: 1) Avoid race conditions from meta file updates. 2) Duplicates are acceptable (idempotent extraction). 3) Bug workaround: Glob search for session_id.jsonl. 4) Keep it simple - premature optimisation avoided.
